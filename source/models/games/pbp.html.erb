<% content_for :title do %>
  <%= game[:home] %> vs <%= game[:away] %> - Play By Play
<% end %>
<% content_for :head do %>
    <script src="http://www.youtube.com/player_api"></script>
    <script type="text/javascript">
        var player, seconds = 0;
        var firstHalf = <%= game[:first_half_start] %>;
        var secondHalf = <%= game[:second_half_start] %>;
        function onYouTubeIframeAPIReady() {
            console.log("player");
            player = new YT.Player('player', {
                events: {
                    'onReady': onPlayerReady
                }
            });
        }

        function onPlayerReady(event) {
            event.target.playVideo();
        }

        function seek(half, sec){
            if(player){
                if(half==1){
                    player.seekTo(sec+firstHalf, true);
                } else {
                    player.seekTo(sec+secondHalf, true);
                }
            }
        }

        function reverse(){
            if(player){
                seconds = player.getCurrentTime() - 15;
                player.seekTo(seconds, true);
            }
        }

        function forward(){
            if(player){
                seconds = player.getCurrentTime() + 15;
                player.seekTo(seconds, true);
            }
        }
    </script>
<% end %>

<div class="h5 mxn1">
  <a href="../../../" title="Home" class="btn compact btn-link p1">Home</a>
  <span class="">
    <span class="muted"> / </span>
    <a href="../../" title="Games" class="btn compact btn-link p1">Games</a>
    <span class="muted"> / </span>
    <a href="../" title="<%= "#{game[:home]} vs #{game[:away]}: Week #{game[:week]}" %>"
      class="btn compact btn-link p1">
      <%= "#{game[:home]} vs #{game[:away]}: Week #{game[:week]}" %>
    </a>
    <span class="muted"> / </span>
    <a href="#" title="<%= "Play-By-Play" %>"
      class="btn compact btn-link p1">
      <%= "Play-By-Play" %>
    </a>
  </span>
</div>

<div>
  <h1><%= game[:home] %> vs <%= game[:away] %> - Play By Play</h1>
  <p>Week <%= game[:week] %> / <%= game[:date] %></p>
  <p>
    First Half: <%= game[:first_half_start] %> /
    Second Half: <%= game[:second_half_start] %> /
    Video URL: <%= game[:video_embed_url] %>
  </p>
</div>

<!--
<iframe id="player" width="854" height="480" src="" frameborder="0"></iframe>
-->

<div>
  <table class="table-light overflow-hidden bg-white border rounded">
    <thead>
      <tr>
        <th>Time</th>
        <th>Team</th>
        <th>Event</th>
        <th>Players</th>
      </tr>
    </thead>
    <% events.each do |event| %>
      <% if event[:half] ==1 %>
        <tr onclick="seek(<%= "#{event[:half]},#{event[:seconds]}" %>)"
          style = "cursor: pointer;"
          onMouseOver="this.style.backgroundColor='silver'"
          onMouseOut="this.style.backgroundColor='transparent'" >
          <td><%= event[:button_text]%></td>
          <td><%= event[:team_alias] %></td>
          <td><%= event[:event_text] %></td>
          <td>
            <% if event[:off_player_name] != "" %>
              OFF: <%= event[:off_player_name] %><br>
            <% end %>
            <% if event[:def_player_name] != "" %>
              DEF: <%= event[:def_player_name] %><br>
            <% end %>
            <% if event[:ast_player_name] != "" %>
              AST: <%= event[:ast_player_name] %>
            <% end %>
          </td>
        </tr>
      <% end %>
    <% end %>
    <% events.each do |event| %>
      <% if event[:half] == 2 %>
        <tr onclick="seek(<%= "#{event[:half]},#{event[:seconds]}" %>)"
          style = "cursor: pointer;"
          onMouseOver="this.style.backgroundColor='silver'"
          onMouseOut="this.style.backgroundColor='transparent'" >
          <td><%= event[:button_text]%></td>
          <td><%= event[:team_alias] %></td>
          <td><%= event[:event_text] %></td>
          <td>
            <% if event[:off_player_name] != "" %>
              OFF: <%= event[:off_player_name] %><br>
            <% end %>
            <% if event[:def_player_name] != "" %>
              DEF: <%= event[:def_player_name] %><br>
            <% end %>
            <% if event[:ast_player_name] != "" %>
              AST: <%= event[:ast_player_name] %>
            <% end %>
          </td>
        </tr>
      <% end %>
    <% end %>
  </table>
</div>
